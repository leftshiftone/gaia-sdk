task clean() {
    doLast {
        execute(["yarn", "clean"])
    }
}

task installDependencies() {
    doLast {
        execute(["yarn", "install"])
    }
}

task test() {
    doLast {
        execute(["yarn", "test"])
    }
}

task assemble() {
    doLast {
        execute(["yarn", "build"])
    }
}

task build() {
    dependsOn test, assemble
}

task publish() {
    doLast {
        //todo: enable publishing to npm
        //execute(["yarn", "publish"])
    }
}
publish.mustRunAfter assemble

private void execute(List<String> command) {
    logger.info("Executing command '${command.join(" ")}'")
    def process = new ProcessBuilder(command).directory(projectDir).start()
    process.consumeProcessOutput(System.out, System.err)
    process.waitFor()
    if (process.exitValue() != 0) throw new RuntimeException("Command '${command.join(" ")}' failed with code ${process.exitValue()}")
    logger.quiet("Executed command '${command.join(" ")}'")
}
